<!--suppress JSAnnotator -->
<template>
    <!-- Page, data-name contains page name which can be used in callbacks -->
    <div class="page " > <!-- page-with-subnavbar -->
        <!-- Top Navbar -->
        <div class="navbar">
            <div class="navbar-bg"></div>
            <div class="navbar-inner">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="icon icon-back"></i>
                    </a>
                </div>
                <div class="title sliding">{{PageTitle}}</div>

            </div>
        </div>


        <div  class="page-content" >
            {{#js_if "this.TemplateID == 1"}}
            <div id="{{MapId}}" class="map"></div>
            {{else}}
            <div class="block-title">
                {{PageTitle}}
                {{#js_if "this.NotificationData && this.NotificationData.customTime"}}
                - {{NotificationData.customTime}}
                {{/js_if}}
            </div>
            <div class="block">
                {{PageSubtitle}}

            </div>
            {{/js_if}}
        </div>

    </div>



</template>


<script>
    // script must return component object
    return {
        data: function () {
            let self = this;
            let ret = {
                PageTitle: LANGUAGE.COM_MSG068,
                MapId: 'Map-' + self.$app.utils.id()
            };
            if(self.$route.query.id){
                let account = localStorage.ACCOUNT;
                let notifications = self.$app.methods.getFromStorage('notifications')[account];
                if (notifications && notifications.length) {
                    let notification = notifications.find(c => c.customId === self.$route.query.id);

                    if (notification) {
                        //ret.NotificationData = self.$app.methods.formatStatusMessage(notification);
                        ret.PageTitle = notification.customTitle;
                        ret.PageSubtitle = notification.customSubtitle;
                        ret.TemplateID = notification.templateID;
                        ret.NotificationData = notification.customContent;
                    }
                }
            }


            return ret;
        },

        methods: {


        },

        on: {
            pageInit: function (e, page) {
                let self = this;

                if(self.TemplateID === 1){
                    self.Map = Helper.Methods.createMap({ target: self.MapId, latLng: [9.675228, -171.364896], zoom: 2 });
                    self.MarkersGroup = L.markerClusterGroup({'maxClusterRadius':35,});
                    console.log(self.NotificationDataiLat)
                    self.MarkerMe = L.marker([self.NotificationData.mLat, self.NotificationData.mLng], { icon: Helper.MarkerIcon[0] });
                    self.MarkerMe
                            .bindPopup(LANGUAGE.COM_MSG070, {maxWidth:self.$app.data.MaxMapPopupWidth, closeButton: false})
                            .addTo(self.MarkersGroup);

                    self.MarkerInfected = L.marker([self.NotificationData.iLat, self.NotificationData.iLng], { icon: Helper.MarkerIcon[3] });
                    self.MarkerInfected
                            .bindPopup(LANGUAGE.COM_MSG071, {maxWidth:self.$app.data.MaxMapPopupWidth, closeButton: false})
                            .addTo(self.MarkersGroup);

                    self.MarkersGroup.addTo(self.Map);
                    if (self.MarkersGroup.getBounds().isValid()) {
                        self.Map.fitBounds(self.MarkersGroup.getBounds(),{padding:[16,16], maxZoom: 13});
                    }
                }


            },
            pageBeforeRemove: function () {
                let self = this;


            }

        }
    };
</script>
